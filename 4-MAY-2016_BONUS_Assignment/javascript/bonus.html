<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>4-MAY-2016 Bonus Assignment</title>
    <meta name="description" content="javascript solution for the day's bonus assignment">
    <meta name="author" content="vishnu" />
    <script>
// Write a function  innerJoin  that uses the three provided arrays to return a new array, where each element is also an array containing three objects, one each pulled from  users ,  books  and  usersHaveBooks . Here's the catch: The user object's  id  property must match the  user_id  property of the  usersHaveBooks  object, and the book object's  id  property must match the  book_id  property of the  usersHaveBooks  object.

// steps:
// 1. traverse thru the user array
// 2. for every user-id, find the entry in usersHaveBooks. This will give us a pair (user1, userhavebook1), (user1, userhavebook2), (user2, userhavebook1) etc
// 3. for each of these pairs, match book-id in userhavebook with the book id in books array. This will give us the required triplet
function innerJoin(arrU, arrB, arrUB){
  // var result = [
  //               [
  //                 {users},
  //                 {usersHaveBooks},
  //                 {books}
  //               ]
  //              ]
  var result = [];
  var cell = [];

  for (var uIdx = 0; uIdx < arrU.length; uIdx++){
    for (var ubIdx = 0; ubIdx < arrUB.length; ubIdx++){
      if (arrU[uIdx].id == arrUB[ubIdx].user_id){
        cell.push(arrU[uIdx]);
        cell.push(arrUB[ubIdx]);
        for (var bIdx = 0; bIdx < arrB.length; bIdx++){
          if (arrUB[ubIdx].book_id == arrB[bIdx].id){
            cell.push(arrB[bIdx]);
            result.push(cell);
            k = arrB.length;
            cell = [];
          }
        }
      }
    }
  }
  return result;
}

var users = [
  {
  id: 1,
  first_name: 'Johnny',
  last_name: 'Rotten',
  created_at:'2012-12-31 23:59:59',
  updated_at:'2012-12-31 23:59:59'
  },
  {
  id: 2,
  first_name: 'Amy',
  last_name: 'Brown',
  created_at:'2012-12-31 23:59:59',
  updated_at:'2012-12-31 23:59:59'
  },
  {
  id: 3,
  first_name: 'Alice',
  last_name: 'Roh',
  created_at:'2012-12-31 23:59:59',
  updated_at:'2012-12-31 23:59:59'
  },

]

var usersHaveBooks = [
  {
    id:1,
    user_id:1,
    book_id:1,
    created_at:'2012-12-31 23:59:59',
    updated_at:'2012-12-31 23:59:59'
  },
  {
    id:1,
    user_id:1,
    book_id:2,
    created_at:'2012-12-31 23:59:59',
    updated_at:'2012-12-31 23:59:59'
  },
  {
    id:1,
    user_id:1,
    book_id:3,
    created_at:'2012-12-31 23:59:59',
    updated_at:'2012-12-31 23:59:59'
  },
  {
    id:1,
    user_id:2,
    book_id:2,
    created_at:'2012-12-31 23:59:59',
    updated_at:'2012-12-31 23:59:59'
  },

]

var books = [
  {
  id: 1,
  book_title: 'Grapes of Wrath',
  book_subject: 'The hard life during the depression',
  created_at:'2012-12-31 23:59:59',
  updated_at:'2012-12-31 23:59:59'
  },
  {
  id: 2,
  book_title: 'Metamorphosis',
  book_subject: 'The degradation of humanity, reflected in a single man',
  created_at:'2015-01-12 23:59:59',
  updated_at:'2015-01-12 23:59:59'
  },
  {
  id: 3,
  book_title: 'The Coming Plague',
  book_subject: 'Infectious diseases',
  created_at:'2015-01-12 23:59:59',
  updated_at:'2015-01-12 23:59:59'
  },
]

joinedArr = innerJoin(users, books, usersHaveBooks);

console.log(`The joined array is ${joinedArr}`);

    </script>
  </head>
  <body>

  </body>
</html>
